<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administraci√≥n - KDS</title>
    <link rel="icon" type="image/png" href="assets/images/favicon.png">
    <link rel="stylesheet" href="css/admin.css">
</head>
<body>
    <!-- PIN Modal -->
    <div class="modal-overlay" id="pinModal">
        <div class="modal">
            <div class="modal-header">
                <h2>üîê Verificaci√≥n de Administrador</h2>
            </div>
            <div class="modal-body">
                <p>Ingresa tu PIN de administrador para continuar:</p>
                <div class="pin-input-container">
                    <input type="password" id="pinInput" maxlength="4" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="off">
                </div>
                <p class="error-message" id="pinError"></p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="window.location.href='dashboard.html'">Cancelar</button>
                <button class="btn btn-primary" onclick="verifyPin()">Verificar</button>
            </div>
        </div>
    </div>

    <!-- Main Content (hidden until PIN verified) -->
    <div class="admin-container" id="adminContent" style="display: none;">
        <!-- Header -->
        <header class="admin-header">
            <div class="header-left">
                <h1>üõ°Ô∏è Panel de Administraci√≥n</h1>
                <span class="admin-badge">Admin</span>
            </div>
            <div class="header-right">
                <span id="adminEmail"></span>
                <button class="btn btn-secondary btn-sm" onclick="logout()">Salir</button>
            </div>
        </header>

        <!-- Stats Cards -->
        <section class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon blue">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                        <circle cx="9" cy="7" r="4"/>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                    </svg>
                </div>
                <div class="stat-info">
                    <span class="stat-value" id="totalTenants">-</span>
                    <span class="stat-label">Total Restaurantes</span>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon green">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                        <polyline points="22 4 12 14.01 9 11.01"/>
                    </svg>
                </div>
                <div class="stat-info">
                    <span class="stat-value" id="activeTenants">-</span>
                    <span class="stat-label">Activos</span>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon purple">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="1" y="4" width="22" height="16" rx="2" ry="2"/>
                        <line x1="1" y1="10" x2="23" y2="10"/>
                    </svg>
                </div>
                <div class="stat-info">
                    <span class="stat-value" id="paidTenants">-</span>
                    <span class="stat-label">De Pago</span>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon orange">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <polyline points="12 6 12 12 16 14"/>
                    </svg>
                </div>
                <div class="stat-info">
                    <span class="stat-value" id="expiringTenants">-</span>
                    <span class="stat-label">Por Vencer (7d)</span>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon red">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <line x1="15" y1="9" x2="9" y2="15"/>
                        <line x1="9" y1="9" x2="15" y2="15"/>
                    </svg>
                </div>
                <div class="stat-info">
                    <span class="stat-value" id="expiredTenants">-</span>
                    <span class="stat-label">Expirados</span>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon teal">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/>
                    </svg>
                </div>
                <div class="stat-info">
                    <span class="stat-value" id="connectedBots">-</span>
                    <span class="stat-label">Bots Conectados</span>
                </div>
            </div>
        </section>

        <!-- Revenue Section -->
        <section class="revenue-section">
            <h2>üí∞ Ingresos</h2>
            <div class="revenue-cards">
                <div class="revenue-card">
                    <span class="revenue-label">Este Mes</span>
                    <span class="revenue-value" id="revenueThisMonth">$0</span>
                </div>
                <div class="revenue-card">
                    <span class="revenue-label">Mes Anterior</span>
                    <span class="revenue-value secondary" id="revenueLastMonth">$0</span>
                </div>
            </div>
        </section>

        <!-- Tenants Table -->
        <section class="tenants-section">
            <div class="section-header">
                <h2>üìã Restaurantes</h2>
                <div class="filters">
                    <select id="filterPlan" onchange="filterTenants()">
                        <option value="all">Todos los planes</option>
                        <option value="trial">Trial</option>
                        <option value="emprendedor">Emprendedor</option>
                        <option value="profesional">Profesional</option>
                        <option value="empresarial">Empresarial</option>
                    </select>
                    <select id="filterStatus" onchange="filterTenants()">
                        <option value="all">Todos los estados</option>
                        <option value="active">Activos</option>
                        <option value="expired">Expirados</option>
                        <option value="expiring">Por vencer</option>
                    </select>
                    <input type="search" id="searchTenant" placeholder="Buscar..." oninput="filterTenants()">
                </div>
            </div>
            
            <div class="table-container">
                <table class="tenants-table">
                    <thead>
                        <tr>
                            <th>Restaurante</th>
                            <th>Plan</th>
                            <th>Estado</th>
                            <th>D√≠as Rest.</th>
                            <th>Pedidos</th>
                            <th>WhatsApp</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="tenantsTableBody">
                        <tr>
                            <td colspan="7" class="loading">Cargando...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Tenant Detail Modal -->
        <div class="modal-overlay" id="tenantModal" style="display: none;">
            <div class="modal modal-large">
                <div class="modal-header">
                    <h2 id="tenantModalTitle">Detalles del Restaurante</h2>
                    <button class="close-btn" onclick="closeTenantModal()">&times;</button>
                </div>
                <div class="modal-body" id="tenantModalBody">
                    <!-- Se llena din√°micamente -->
                </div>
            </div>
        </div>

        <!-- Extend Plan Modal -->
        <div class="modal-overlay" id="extendModal" style="display: none;">
            <div class="modal">
                <div class="modal-header">
                    <h2>üìÖ Extender/Activar Plan</h2>
                    <button class="close-btn" onclick="closeExtendModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <p>Restaurante: <strong id="extendTenantName"></strong></p>
                    <input type="hidden" id="extendTenantId">
                    
                    <div class="form-group">
                        <label>Plan:</label>
                        <select id="extendPlan">
                            <option value="emprendedor">Emprendedor ($90.000)</option>
                            <option value="profesional">Profesional ($120.000)</option>
                            <option value="empresarial">Empresarial ($150.000)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>D√≠as:</label>
                        <input type="number" id="extendDays" value="30" min="1" max="365">
                    </div>
                    
                    <div class="form-group">
                        <label>Raz√≥n (opcional):</label>
                        <input type="text" id="extendReason" placeholder="Ej: Cortes√≠a por problema t√©cnico">
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeExtendModal()">Cancelar</button>
                    <button class="btn btn-primary" onclick="confirmExtend()">Activar Plan</button>
                </div>
            </div>
        </div>

        <!-- Notify Modal -->
        <div class="modal-overlay" id="notifyModal" style="display: none;">
            <div class="modal">
                <div class="modal-header">
                    <h2>üì± Enviar Notificaci√≥n</h2>
                    <button class="close-btn" onclick="closeNotifyModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <p>Restaurante: <strong id="notifyTenantName"></strong></p>
                    <input type="hidden" id="notifyTenantId">
                    
                    <div class="form-group">
                        <label>Tipo:</label>
                        <select id="notifyType">
                            <option value="info">‚ÑπÔ∏è Informaci√≥n</option>
                            <option value="warning">‚ö†Ô∏è Advertencia</option>
                            <option value="urgent">üö® Urgente</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Mensaje:</label>
                        <textarea id="notifyMessage" rows="4" placeholder="Escribe el mensaje..."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeNotifyModal()">Cancelar</button>
                    <button class="btn btn-primary" onclick="sendNotification()">Enviar</button>
                </div>
            </div>
        </div>

        <!-- Partners Section -->
        <section class="partners-section" id="partnersSection">
            <div class="section-header">
                <h2>ü§ù Socios Comerciales</h2>
                <button class="btn btn-primary" onclick="openNewPartnerModal()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"/>
                        <line x1="5" y1="12" x2="19" y2="12"/>
                    </svg>
                    Nuevo Socio
                </button>
            </div>
            
            <!-- Partners Stats -->
            <div class="partners-stats">
                <div class="partner-stat-card">
                    <span class="partner-stat-value" id="totalPartners">0</span>
                    <span class="partner-stat-label">Socios Activos</span>
                </div>
                <div class="partner-stat-card">
                    <span class="partner-stat-value" id="totalReferidosPartners">0</span>
                    <span class="partner-stat-label">Total Referidos</span>
                </div>
                <div class="partner-stat-card highlight">
                    <span class="partner-stat-value" id="comisionesPendientes">$0</span>
                    <span class="partner-stat-label">Comisiones Pendientes</span>
                </div>
            </div>
            
            <!-- Partners Tabs -->
            <div class="partners-tabs">
                <button class="partners-tab active" data-tab="socios" onclick="cambiarPartnerTab('socios')">Socios</button>
                <button class="partners-tab" data-tab="comisiones" onclick="cambiarPartnerTab('comisiones')">Comisiones Pendientes</button>
            </div>
            
            <!-- Socios Tab -->
            <div class="partners-tab-content active" id="sociosTab">
                <div class="table-container">
                    <table class="partners-table">
                        <thead>
                            <tr>
                                <th>Socio</th>
                                <th>C√≥digo</th>
                                <th>Referidos</th>
                                <th>Comisiones</th>
                                <th>Pendiente</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="partnersTableBody">
                            <tr>
                                <td colspan="7" class="loading">Cargando socios...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Comisiones Tab -->
            <div class="partners-tab-content" id="comisionesAdminTab">
                <div class="table-container">
                    <table class="comisiones-table">
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Socio</th>
                                <th>Restaurante</th>
                                <th>Membres√≠a</th>
                                <th>Comisi√≥n</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="comisionesAdminTableBody">
                            <tr>
                                <td colspan="6" class="loading">Cargando comisiones...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- New Partner Modal -->
        <div class="modal-overlay" id="newPartnerModal" style="display: none;">
            <div class="modal">
                <div class="modal-header">
                    <h2>‚ûï Nuevo Socio Comercial</h2>
                    <button class="close-btn" onclick="closeNewPartnerModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>Nombre completo *</label>
                        <input type="text" id="partnerNombre" placeholder="Ej: Juan P√©rez" required>
                    </div>
                    <div class="form-group">
                        <label>Email *</label>
                        <input type="email" id="partnerEmail" placeholder="Ej: juan@email.com" required>
                    </div>
                    <div class="form-group">
                        <label>Tel√©fono</label>
                        <input type="tel" id="partnerTelefono" placeholder="Ej: +573001234567">
                    </div>
                    
                    <h4 style="margin: 16px 0 8px;">üí≥ Datos de Pago</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Banco</label>
                            <input type="text" id="partnerBanco" placeholder="Ej: Bancolombia">
                        </div>
                        <div class="form-group">
                            <label>Tipo de Cuenta</label>
                            <select id="partnerTipoCuenta">
                                <option value="">Seleccionar...</option>
                                <option value="Ahorros">Ahorros</option>
                                <option value="Corriente">Corriente</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>N√∫mero de Cuenta</label>
                            <input type="text" id="partnerNumeroCuenta" placeholder="Ej: 123456789">
                        </div>
                        <div class="form-group">
                            <label>C√©dula</label>
                            <input type="text" id="partnerCedula" placeholder="Ej: 1234567890">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeNewPartnerModal()">Cancelar</button>
                    <button class="btn btn-primary" onclick="crearNuevoPartner()">Crear Socio</button>
                </div>
            </div>
        </div>

        <!-- Pay Commission Modal -->
        <div class="modal-overlay" id="payCommissionModal" style="display: none;">
            <div class="modal">
                <div class="modal-header">
                    <h2>üíµ Pagar Comisi√≥n</h2>
                    <button class="close-btn" onclick="closePayCommissionModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <p><strong>Socio:</strong> <span id="payPartnerName"></span></p>
                    <p><strong>Valor:</strong> <span id="payCommissionAmount"></span></p>
                    <input type="hidden" id="payCommissionId">
                    
                    <div class="form-group" style="margin-top: 16px;">
                        <label>Referencia de Pago *</label>
                        <input type="text" id="payReference" placeholder="Ej: Nequi-05022026, Trans#123456">
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closePayCommissionModal()">Cancelar</button>
                    <button class="btn btn-primary" onclick="confirmarPagoComision()">Confirmar Pago</button>
                </div>
            </div>
        </div>
    </div>

    <script src="js/admin.js"></script>
</body>
</html>
