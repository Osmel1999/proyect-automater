# ðŸŽ¨ Diagrama de Secuencia - Flujo de MÃ©todo de Pago

VisualizaciÃ³n completa del flujo de pedidos con selecciÃ³n de mÃ©todo de pago.

---

## ðŸ“Š Diagrama de Secuencia Completo

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cliente â”‚     â”‚  Bot   â”‚     â”‚ Firebase â”‚     â”‚  Wompi   â”‚     â”‚Dashboardâ”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚              â”‚               â”‚                â”‚                â”‚
     â”‚ 1. "hola"    â”‚               â”‚                â”‚                â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚                â”‚                â”‚
     â”‚              â”‚               â”‚                â”‚                â”‚
     â”‚   MenÃº       â”‚               â”‚                â”‚                â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚               â”‚                â”‚                â”‚
     â”‚              â”‚               â”‚                â”‚                â”‚
     â”‚ 2. "Quiero 2 â”‚               â”‚                â”‚                â”‚
     â”‚ hamburguesas"â”‚               â”‚                â”‚                â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚                â”‚                â”‚
     â”‚              â”‚               â”‚                â”‚                â”‚
     â”‚   ConfirmaciÃ³nâ”‚              â”‚                â”‚                â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚               â”‚                â”‚                â”‚
     â”‚              â”‚               â”‚                â”‚                â”‚
     â”‚ 3. "sÃ­"      â”‚               â”‚                â”‚                â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚                â”‚                â”‚
     â”‚              â”‚               â”‚                â”‚                â”‚
     â”‚   Solicita   â”‚               â”‚                â”‚                â”‚
     â”‚   direcciÃ³n  â”‚               â”‚                â”‚                â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚               â”‚                â”‚                â”‚
     â”‚              â”‚               â”‚                â”‚                â”‚
     â”‚ 4. "Calle 80 â”‚               â”‚                â”‚                â”‚
     â”‚    #12-34"   â”‚               â”‚                â”‚                â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚                â”‚                â”‚
     â”‚              â”‚               â”‚                â”‚                â”‚
     â”‚   Solicita   â”‚               â”‚                â”‚                â”‚
     â”‚   telÃ©fono   â”‚               â”‚                â”‚                â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚               â”‚                â”‚                â”‚
     â”‚              â”‚               â”‚                â”‚                â”‚
     â”‚ 5. "300      â”‚               â”‚                â”‚                â”‚
     â”‚    1234567"  â”‚               â”‚                â”‚                â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚                â”‚                â”‚
     â”‚              â”‚               â”‚                â”‚                â”‚
     â”‚              â”‚ Verificar     â”‚                â”‚                â”‚
     â”‚              â”‚ gateway       â”‚                â”‚                â”‚
     â”‚              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚                â”‚
     â”‚              â”‚               â”‚                â”‚                â”‚
     â”‚              â”‚ Gateway       â”‚                â”‚                â”‚
     â”‚              â”‚ configurado   â”‚                â”‚                â”‚
     â”‚              â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚                â”‚
     â”‚              â”‚               â”‚                â”‚                â”‚
     â”‚   Pregunta   â”‚               â”‚                â”‚                â”‚
     â”‚   mÃ©todo pagoâ”‚               â”‚                â”‚                â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚               â”‚                â”‚                â”‚
     â”‚              â”‚               â”‚                â”‚                â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                    ðŸ”€ BIFURCACIÃ“N                               â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚              â”‚               â”‚                â”‚                â”‚
â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚   OPCIÃ“N A: TARJETA      â”‚   â”‚   OPCIÃ“N B: EFECTIVO        â”‚       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
     â”‚              â”‚               â”‚                â”‚                â”‚
     â”‚ 6a. "tarjeta"â”‚               â”‚ 6b. "efectivo" â”‚                â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚
     â”‚              â”‚               â”‚                â”‚                â”‚
     â”‚              â”‚ Crear pedido  â”‚ Crear pedido   â”‚                â”‚
     â”‚              â”‚ estado:       â”‚ estado:        â”‚                â”‚
     â”‚              â”‚ pendiente_pagoâ”‚ pendiente      â”‚                â”‚
     â”‚              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚
     â”‚              â”‚               â”‚                â”‚                â”‚
     â”‚              â”‚ Pedido ID     â”‚ Pedido ID      â”‚                â”‚
     â”‚              â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚
     â”‚              â”‚               â”‚                â”‚                â”‚
     â”‚              â”‚ Crear enlace  â”‚                â”‚                â”‚
     â”‚              â”‚ de pago       â”‚                â”‚                â”‚
     â”‚              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚
     â”‚              â”‚               â”‚                â”‚                â”‚
     â”‚              â”‚               â”‚  Link generado â”‚                â”‚
     â”‚              â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚
     â”‚              â”‚               â”‚                â”‚                â”‚
     â”‚              â”‚ Actualizar    â”‚                â”‚                â”‚
     â”‚              â”‚ pedido con    â”‚                â”‚                â”‚
     â”‚              â”‚ paymentLink   â”‚                â”‚                â”‚
     â”‚              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚                â”‚
     â”‚              â”‚               â”‚                â”‚                â”‚
     â”‚   Mensaje    â”‚               â”‚   Mensaje      â”‚                â”‚
     â”‚   con enlace â”‚               â”‚   sin enlace   â”‚                â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚               â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚
     â”‚              â”‚               â”‚                â”‚                â”‚
     â”‚ 7a. Cliente  â”‚               â”‚ 7b. Cocina     â”‚                â”‚
     â”‚ hace clic en â”‚               â”‚ prepara pedido â”‚                â”‚
     â”‚ enlace       â”‚               â”‚                â”‚                â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚                â”‚
     â”‚              â”‚               â”‚                â”‚                â”‚
     â”‚   PÃ¡gina de  â”‚               â”‚                â”‚                â”‚
     â”‚   Wompi      â”‚               â”‚                â”‚                â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚                â”‚
     â”‚              â”‚               â”‚                â”‚                â”‚
     â”‚ 8a. Cliente  â”‚               â”‚                â”‚                â”‚
     â”‚ paga         â”‚               â”‚                â”‚                â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚                â”‚
     â”‚              â”‚               â”‚                â”‚                â”‚
     â”‚              â”‚               â”‚  Webhook       â”‚                â”‚
     â”‚              â”‚               â”‚  aprobado      â”‚                â”‚
     â”‚              â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚
     â”‚              â”‚               â”‚                â”‚                â”‚
     â”‚              â”‚ Actualizar    â”‚                â”‚                â”‚
     â”‚              â”‚ estado:       â”‚                â”‚                â”‚
     â”‚              â”‚ confirmado    â”‚                â”‚                â”‚
     â”‚              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚                â”‚
     â”‚              â”‚               â”‚                â”‚                â”‚
     â”‚              â”‚               â”‚                â”‚   NotificaciÃ³n â”‚
     â”‚              â”‚               â”‚                â”‚   pedido nuevo â”‚
     â”‚              â”‚               â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚              â”‚               â”‚                â”‚                â”‚
     â”‚   Pago       â”‚               â”‚ 8b. Domiciliario                â”‚
     â”‚   confirmado â”‚               â”‚ entrega pedido â”‚                â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚               â”‚ Cliente paga   â”‚                â”‚
     â”‚              â”‚               â”‚ en efectivo    â”‚                â”‚
     â”‚              â”‚               â”‚                â”‚                â”‚
```

---

## ðŸŽ¯ Flujo Simplificado (Tarjeta)

```
Cliente  â†’  Pedido  â†’  DirecciÃ³n  â†’  TelÃ©fono  â†’  "Â¿CÃ³mo pagar?"
                                                          â†“
                                                      "tarjeta"
                                                          â†“
                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                              â”‚ Genera enlace     â”‚
                                              â”‚ Wompi            â”‚
                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                          â†“
                                              Enlace â†’ Cliente â†’ Paga
                                                          â†“
                                                      Webhook
                                                          â†“
                                              Estado: confirmado
```

---

## ðŸ’µ Flujo Simplificado (Efectivo)

```
Cliente  â†’  Pedido  â†’  DirecciÃ³n  â†’  TelÃ©fono  â†’  "Â¿CÃ³mo pagar?"
                                                          â†“
                                                     "efectivo"
                                                          â†“
                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                              â”‚ NO genera enlace  â”‚
                                              â”‚ Confirma directo  â”‚
                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                          â†“
                                              Estado: pendiente
                                                          â†“
                                              Cocina â†’ Prepara
                                                          â†“
                                              Domiciliario â†’ Entrega
                                                          â†“
                                              Cliente paga en efectivo
```

---

## ðŸ”„ Estados del Pedido

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      INICIO DEL PEDIDO                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â†“
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚  Cliente confirma   â”‚
                 â”‚  direcciÃ³n y tel.   â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â†“
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚ Â¿Gateway activo?    â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                                     â”‚
         â†“ SÃ                                  â†“ NO
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Pregunta mÃ©todo â”‚                  â”‚ Confirma directoâ”‚
â”‚ de pago         â”‚                  â”‚ sin pregunta    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                     â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”                              â†“
    â”‚          â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â†“          â†“                     â”‚ Estado:         â”‚
Tarjeta    Efectivo                 â”‚ pendiente       â”‚
    â”‚          â”‚                     â”‚ paymentStatus:  â”‚
    â”‚          â”‚                     â”‚ CASH            â”‚
    â”‚          â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚          â†“
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   â”‚ Estado:         â”‚
    â”‚   â”‚ pendiente       â”‚
    â”‚   â”‚ paymentStatus:  â”‚
    â”‚   â”‚ CASH            â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Estado:         â”‚
â”‚ pendiente_pago  â”‚
â”‚ paymentStatus:  â”‚
â”‚ PENDING         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“ Cliente paga
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Webhook recibe  â”‚
â”‚ confirmaciÃ³n    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Estado:         â”‚
â”‚ confirmado      â”‚
â”‚ paymentStatus:  â”‚
â”‚ APPROVED        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸŽ¬ Ejemplo de ConversaciÃ³n Real

### Escenario: Cliente elige TARJETA

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cliente: hola                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Bot: ðŸ‘‹ Â¡Hola! Bienvenido a La Vaca Loca                â”‚
â”‚                                                          â”‚
â”‚ ðŸ” MENÃš:                                                 â”‚
â”‚ 1. Hamburguesa - $20.000                                â”‚
â”‚ 2. Pizza - $25.000                                      â”‚
â”‚ 3. Coca Cola - $5.000                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cliente: Quiero 2 hamburguesas y 1 coca cola             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Bot: ðŸ“‹ Tu pedido:                                       â”‚
â”‚ â€¢ 2x Hamburguesa - $40.000                              â”‚
â”‚ â€¢ 1x Coca Cola - $5.000                                 â”‚
â”‚                                                          â”‚
â”‚ ðŸ’° Total: $45.000                                        â”‚
â”‚                                                          â”‚
â”‚ Â¿Confirmas este pedido?                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cliente: sÃ­                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Bot: ðŸ“ Â¡Perfecto! Solo necesitamos tu direcciÃ³n        â”‚
â”‚ Â¿A dÃ³nde enviamos tu pedido? ðŸ                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cliente: Calle 80 #12-34                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Bot: ðŸ“± Â¡Genial! Ahora tu nÃºmero de contacto            â”‚
â”‚ Â¿CuÃ¡l es tu nÃºmero? â˜Žï¸                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cliente: 3001234567                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Bot: ðŸ’³ Â¿CÃ³mo deseas pagar tu pedido?                   â”‚
â”‚                                                          â”‚
â”‚ ðŸ’° Total a pagar: $45.000                                â”‚
â”‚                                                          â”‚
â”‚ 1ï¸âƒ£ Tarjeta - Pago seguro en lÃ­nea                       â”‚
â”‚ 2ï¸âƒ£ Efectivo/Transferencia - Al recibir                  â”‚
â”‚                                                          â”‚
â”‚ Responde tarjeta o efectivo                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cliente: tarjeta                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Bot: ðŸŽ‰ Â¡Tu pedido estÃ¡ casi listo!                     â”‚
â”‚                                                          â”‚
â”‚ ðŸ“‹ NÃºmero de pedido: #A3F5B2                            â”‚
â”‚ ðŸ“ DirecciÃ³n: Calle 80 #12-34                           â”‚
â”‚ ðŸ’° Total a pagar: $45.000                                â”‚
â”‚                                                          â”‚
â”‚ ðŸ’³ PAGO SEGURO EN LÃNEA                                 â”‚
â”‚                                                          â”‚
â”‚ ðŸ‘‰ Haz clic aquÃ­ para pagar ahora:                      â”‚
â”‚ https://checkout.wompi.co/l/aBc123...                   â”‚
â”‚                                                          â”‚
â”‚ ðŸ”’ Pago 100% seguro y encriptado                        â”‚
â”‚                                                          â”‚
â”‚ Te avisaremos cuando estÃ© listo ðŸ›µ                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ” ComparaciÃ³n: Antes vs. Ahora

### âŒ ANTES (Sin Pregunta)

```
Cliente â†’ Pedido â†’ Confirma â†’ ðŸ’³ ENLACE OBLIGATORIO
                              (Cliente forzado a pagar online)
```

### âœ… AHORA (Con Pregunta)

```
Cliente â†’ Pedido â†’ Confirma â†’ "Â¿CÃ³mo pagar?"
                                    â”œâ”€ Tarjeta â†’ ðŸ’³ Enlace
                                    â””â”€ Efectivo â†’ ðŸ’µ Sin enlace
```

---

## ðŸ“Š Tabla de DecisiÃ³n

| SituaciÃ³n | Gateway Activo | Pregunta | Genera Enlace | Estado Final |
|-----------|----------------|----------|---------------|--------------|
| Cliente elige tarjeta | âœ… SÃ | âœ… SÃ | âœ… SÃ | pendiente_pago |
| Cliente elige efectivo | âœ… SÃ | âœ… SÃ | âŒ NO | pendiente |
| Gateway NO configurado | âŒ NO | âŒ NO | âŒ NO | pendiente |
| Error generando enlace | âœ… SÃ | âœ… SÃ | âŒ NO (fallback) | pendiente |

---

## ðŸŽ¨ Diagrama de Estados de SesiÃ³n

```
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚   INICIO    â”‚
                        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ esperandoPedido  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â†“
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚esperandoConfirmacionâ”‚
                 â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â†“
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚esperandoDireccionâ”‚
                â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â†“
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚esperandoTelefono â”‚
               â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Â¿Gateway configurado?   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                     â”‚
      â†“ SÃ                  â†“ NO
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚esperandoMetodoPagoâ”‚  â”‚ CONFIRMAR   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ (directo)   â”‚
       â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”
   â”‚        â”‚
   â†“        â†“
Tarjeta  Efectivo
   â”‚        â”‚
   â†“        â†“
ENLACE   SIN ENLACE
```

---

## ðŸ’¾ Estructura de Datos en Firebase

### Pedido con TARJETA
```javascript
{
  id: "A3F5B2",
  tenantId: "tenant_12345",
  cliente: "3009876543",
  telefono: "3009876543",
  telefonoContacto: "3001234567",
  direccion: "Calle 80 #12-34",
  items: [
    { numero: "1", nombre: "Hamburguesa", precio: 20000, cantidad: 2 },
    { numero: "3", nombre: "Coca Cola", precio: 5000, cantidad: 1 }
  ],
  total: 45000,
  estado: "pendiente_pago",      // â† Estado inicial
  paymentStatus: "PENDING",       // â† Esperando pago
  metodoPago: "tarjeta",          // â† MÃ©todo elegido
  paymentLink: "https://...",     // â† Enlace generado
  paymentTransactionId: "wompi_txn_12345",
  paymentReference: "KDSAPP-A3F5B2-1737048000",
  timestamp: 1737048000000,
  fecha: "2025-01-16T18:00:00.000Z",
  fuente: "whatsapp",
  restaurante: "La Vaca Loca"
}
```

### Pedido con EFECTIVO
```javascript
{
  id: "B4G6C3",
  tenantId: "tenant_12345",
  cliente: "3009876543",
  telefono: "3009876543",
  telefonoContacto: "3001234567",
  direccion: "Calle 80 #12-34",
  items: [
    { numero: "1", nombre: "Hamburguesa", precio: 20000, cantidad: 2 },
    { numero: "3", nombre: "Coca Cola", precio: 5000, cantidad: 1 }
  ],
  total: 45000,
  estado: "pendiente",            // â† Sin pago online
  paymentStatus: "CASH",          // â† Pago en efectivo
  metodoPago: "efectivo",         // â† MÃ©todo elegido
  // SIN paymentLink
  // SIN paymentTransactionId
  timestamp: 1737048000000,
  fecha: "2025-01-16T18:00:00.000Z",
  fuente: "whatsapp",
  restaurante: "La Vaca Loca"
}
```

---

## ðŸš¦ LÃ³gica de DecisiÃ³n en el CÃ³digo

```javascript
// DespuÃ©s de validar telÃ©fono
if (gatewayConfig && gatewayConfig.enabled) {
  // âœ… Gateway activo â†’ Preguntar mÃ©todo de pago
  return solicitarMetodoPago(sesion);
} else {
  // âŒ Gateway NO activo â†’ Confirmar directo (flujo tradicional)
  return await confirmarPedido(sesion);
}
```

```javascript
// Procesando respuesta del cliente
if (respuesta incluye "tarjeta") {
  sesion.metodoPago = 'tarjeta';
  // âœ… Genera enlace de pago
  return await confirmarPedido(sesion);
}

if (respuesta incluye "efectivo") {
  sesion.metodoPago = 'efectivo';
  // âŒ NO genera enlace
  return await confirmarPedidoEfectivo(sesion);
}
```

---

**Ãšltima actualizaciÃ³n:** 16/01/2025 - 14:45 COT
