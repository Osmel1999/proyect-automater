<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - KDS Platform</title>
  <meta name="description" content="ConfiguraciÃ³n y gestiÃ³n de tu restaurante">
  <link rel="icon" type="image/png" href="assets/images/kds-logo.png">
  
  <!-- Dashboard Styles -->
  <link rel="stylesheet" href="css/dashboard.css">
  <link rel="stylesheet" href="css/animations.css">
</head>
<body>
  <!-- Header -->
  <div class="header animate-fade-in-down">
    <div class="header-left">
      <div class="logo">KDS</div>
      <div class="tenant-name" id="tenant-name">Cargando...</div>
    </div>
    <div class="header-right">
      <!-- Admin Button (solo para admin) -->
      <a href="/admin.html" class="btn-admin" id="btn-admin" style="display: none;">
        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
        </svg>
        Admin
      </a>
      
      <!-- WhatsApp Status -->
      <div class="whatsapp-status disconnected" id="whatsapp-status" style="display: none;">
        <span class="status-dot disconnected" id="status-dot"></span>
        <span id="status-text">Desconectado</span>
      </div>
      
      <!-- Disconnect WhatsApp Button -->
      <button class="btn-disconnect" id="btn-disconnect-whatsapp" style="display: none;" onclick="disconnectWhatsApp()">
        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
        </svg>
        Desconectar WhatsApp
      </button>
      
      <!-- Connect WhatsApp Button -->
      <button class="btn-connect" id="btn-connect-whatsapp" style="display: none;" onclick="connectWhatsApp()">
        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
        </svg>
        Conectar WhatsApp
      </button>
      
      <a href="/kds.html" class="btn-secondary" id="kdsBtn">
        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
        </svg>
        Ver KDS
      </a>
      <a href="/select.html" class="btn-secondary">
        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
        </svg>
        Inicio
      </a>
    </div>
  </div>

  <!-- Main Content -->
  <div class="container">
    <div id="loading-container" class="loading">
      <div class="spinner"></div>
      <p>Cargando tu configuraciÃ³n...</p>
    </div>

    <!-- Bot Control Card -->
    <div id="bot-control-container" style="display: none;">
      <div class="bot-control-card card-animated hover-lift" id="bot-control-card">
        <div class="bot-control-icon">
          <svg width="36" height="36" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
          </svg>
        </div>
        <div class="bot-control-content">
          <div class="bot-control-title">Bot de WhatsApp</div>
          <div class="bot-control-status" id="bot-status-text">
            <span class="status-dot"></span>
            <span id="bot-status-label">Cargando...</span>
          </div>
        </div>
        <div class="bot-toggle-container">
          <div class="bot-toggle" id="bot-toggle" onclick="toggleBot()">
            <div class="bot-toggle-slider"></div>
          </div>
          <span class="bot-toggle-label" id="bot-toggle-label">OFF</span>
        </div>
      </div>

      <!-- Warning cuando el onboarding estÃ¡ incompleto -->
      <div class="bot-warning" id="bot-warning">
        <div class="bot-warning-title">
          <span>âš ï¸</span>
          <span>Completa tu configuraciÃ³n primero</span>
        </div>
        <div class="bot-warning-text">
          Para activar el bot, debes completar al menos el 75% del onboarding (menÃº configurado y mensajes personalizados).
          Esto asegura que tus clientes tengan una buena experiencia al usar el bot.
        </div>
      </div>

      <!-- Modo Pedido RÃ¡pido -->
      <div class="bot-control-card card-animated hover-lift" id="quick-order-card" style="margin-top: 16px;">
        <div class="bot-control-icon">
          <svg width="36" height="36" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
          </svg>
        </div>
        <div class="bot-control-content">
          <div class="bot-control-title">Modo Pedido RÃ¡pido</div>
          <div class="bot-control-status" id="quick-order-status-text">
            <span class="status-dot"></span>
            <span id="quick-order-status-label">Cargando...</span>
          </div>
        </div>
        <div class="bot-toggle-container">
          <div class="bot-toggle" id="quick-order-toggle" onclick="toggleQuickOrder()">
            <div class="bot-toggle-slider"></div>
          </div>
          <span class="bot-toggle-label" id="quick-order-toggle-label">OFF</span>
        </div>
      </div>
      
      <!-- Info del modo pedido rÃ¡pido -->
      <div class="quick-order-info" id="quick-order-info" style="display: none; margin-top: 12px; padding: 16px; background: var(--primary-light); border-radius: 12px; border: 1px solid var(--primary);">
        <div style="display: flex; align-items: flex-start; gap: 12px;">
          <svg width="24" height="24" fill="none" stroke="var(--primary)" viewBox="0 0 24 24" style="flex-shrink: 0; margin-top: 2px;">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
          <div>
            <div style="font-weight: 600; color: var(--primary-hover); margin-bottom: 4px;">Â¿CÃ³mo funciona?</div>
            <div style="font-size: 13px; color: var(--text-secondary); line-height: 1.5;">
              En lugar de una conversaciÃ³n larga, el bot envÃ­a un formulario que el cliente copia, edita y envÃ­a de vuelta. 
              Esto reduce mensajes y acelera los pedidos. El cliente ve tu catÃ¡logo de WhatsApp para elegir productos.
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Wizard (hidden initially) -->
    <div id="wizard-container" style="display: none;">
      <div class="wizard-card animate-fade-in-scale">
        <div class="wizard-header animate-fade-in-up">
          <h1 class="wizard-title">
            <svg class="icon-lg" style="display: inline-block; vertical-align: middle; margin-right: 8px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
            </svg>
            Â¡Bienvenido a KDS Platform!
          </h1>
          <p class="wizard-subtitle">Completa estos pasos para empezar a recibir pedidos automÃ¡ticamente</p>
        </div>

        <!-- Progress Bar -->
        <div class="progress-container">
          <div class="progress-text">
            <span class="progress-label">Tu progreso</span>
            <span class="progress-percentage" id="progress-percentage">25%</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" id="progress-fill" style="width: 25%"></div>
          </div>
        </div>

        <!-- Steps -->
        <div class="steps">
          <!-- Step 1: WhatsApp -->
          <div class="step-item" id="step-1">
            <div class="step-icon">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"/>
              </svg>
            </div>
            <div class="step-content">
              <div class="step-title">1. Conectar WhatsApp</div>
              <div class="step-description">Vincula tu nÃºmero de WhatsApp Business para recibir pedidos</div>
            </div>
            <div class="step-action">
              <button class="btn-step" onclick="connectWhatsAppStep()">Conectar â†’</button>
            </div>
          </div>

          <!-- Step 2: Menu -->
          <div class="step-item" id="step-2">
            <div class="step-icon">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
              </svg>
            </div>
            <div class="step-content">
              <div class="step-title">2. Configurar tu menÃº</div>
              <div class="step-description">Agrega los productos que tus clientes pueden ordenar (5 min)</div>
            </div>
            <div class="step-action">
              <button class="btn-step" onclick="openMenuConfig()">Configurar â†’</button>
            </div>
          </div>

          <!-- Step 3: Messages -->
          <div class="step-item" id="step-3">
            <div class="step-icon">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
              </svg>
            </div>
            <div class="step-content">
              <div class="step-title">3. Personalizar mensajes</div>
              <div class="step-description">Ajusta los mensajes automÃ¡ticos que envÃ­a el bot (3 min)</div>
            </div>
            <div class="step-action">
              <button class="btn-step" onclick="openMessagesConfig()">Personalizar â†’</button>
            </div>
          </div>

          <!-- Step 4: Activate Bot -->
          <div class="step-item" id="step-4">
            <div class="step-icon">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
              </svg>
            </div>
            <div class="step-content">
              <div class="step-title">4. Activar el bot</div>
              <div class="step-description">Enciende el bot para empezar a recibir pedidos automÃ¡ticamente</div>
            </div>
            <div class="step-action">
              <button class="btn-step" id="activate-bot-btn" onclick="activateBotStep()" disabled>Activar â†’</button>
            </div>
          </div>
        </div>

        <!-- Footer -->
        <div class="wizard-footer">
          <button class="btn-skip" onclick="skipOnboarding()">Saltar por ahora, explorar por mi cuenta</button>
        </div>
      </div>
    </div>

    <!-- Completion Card / Dashboard (hidden initially) -->
    <div id="completion-container" style="display: none;">
      <div class="dashboard-main">
        <!-- Stats Cards -->
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
              </svg>
            </div>
            <div class="stat-content">
              <div class="stat-label">Pedidos Hoy</div>
              <div class="stat-value" id="orders-today">0</div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
            </div>
            <div class="stat-content">
              <div class="stat-label">Ventas Hoy</div>
              <div class="stat-value" id="sales-today">$0</div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
              </svg>
            </div>
            <div class="stat-content">
              <div class="stat-label">WhatsApp</div>
              <div class="stat-value" id="whatsapp-status-main">Conectado</div>
            </div>
          </div>
        </div>

        <!-- Quick Actions -->
        <div class="dashboard-section">
          <h2 class="section-title-main">
            <svg class="icon-lg" style="display: inline-block; vertical-align: middle; margin-right: 8px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
            </svg>
            Acciones RÃ¡pidas
          </h2>
          <div class="actions-grid">
            <div class="action-card" onclick="openMenuConfig()">
              <div class="action-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                </svg>
              </div>
              <h3>Gestionar MenÃº</h3>
              <p>Agregar, editar o eliminar productos de tu menÃº</p>
            </div>
            <div class="action-card" onclick="openMessagesConfig()">
              <div class="action-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                </svg>
              </div>
              <h3>Personalizar Mensajes</h3>
              <p>Editar mensajes automÃ¡ticos del bot</p>
            </div>
            <div class="action-card" onclick="openPaymentConfig()">
              <div class="action-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/>
                </svg>
              </div>
              <h3>Configurar Pagos</h3>
              <p>Activar pagos online con Wompi</p>
            </div>
            <div class="action-card" onclick="window.location.href='kds.html'">
              <div class="action-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                </svg>
              </div>
              <h3>Pantalla de Cocina</h3>
              <p>Ver pedidos en tiempo real (KDS)</p>
            </div>
            <div class="action-card" onclick="openDeliveryTimeConfig()">
              <div class="action-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
              </div>
              <h3>Tiempo de Entrega</h3>
              <p>Configurar tiempo estimado de entrega</p>
            </div>
            <div class="action-card" onclick="openDeliveryCostConfig()">
              <div class="action-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                </svg>
              </div>
              <h3>Costo de EnvÃ­o</h3>
              <p>Configurar precio del domicilio</p>
            </div>
            <div class="action-card" onclick="openBusinessHoursConfig()">
              <div class="action-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                </svg>
              </div>
              <h3>Horarios de AtenciÃ³n</h3>
              <p>Configurar dÃ­as y horas de atenciÃ³n</p>
            </div>
            <div class="action-card" onclick="openMyPlanModal()">
              <div class="action-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"/>
                </svg>
              </div>
              <h3>Mi Plan</h3>
              <p>Ver y actualizar tu membresÃ­a</p>
            </div>
          </div>
        </div>

        <!-- Menu Preview -->
        <div class="dashboard-section">
          <div class="section-header-main">
            <h2 class="section-title-main">
              <svg class="icon-lg" style="display: inline-block; vertical-align: middle; margin-right: 8px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
              </svg>
              Tu MenÃº
            </h2>
            <button class="btn-primary" onclick="openMenuConfig()">+ Agregar Producto</button>
          </div>
          <div id="menu-list-preview" class="menu-preview-grid">
            <p style="color: #718096;">Cargando menÃº...</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal: Menu Config -->
  <div class="modal-overlay" id="menu-modal">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">
          <svg class="icon-lg" style="display: inline-block; vertical-align: middle; margin-right: 8px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
          </svg>
          Configurar MenÃº
        </h2>
        <button class="modal-close" onclick="closeMenuModal()">Ã—</button>
      </div>
      <div class="modal-body">
        <p style="margin-bottom: 24px; color: #718096;">
          Agrega los productos de tu menÃº. Los clientes podrÃ¡n ordenarlos por WhatsApp.
        </p>

        <!-- Seccion: Subir foto del menu -->
        <div class="upload-menu-section" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; padding: 20px; margin-bottom: 24px; color: white;">
          <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
            <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
            </svg>
            <span style="font-weight: 600; font-size: 16px;">Subir foto del menu (IA)</span>
          </div>
          <p style="font-size: 14px; opacity: 0.9; margin-bottom: 16px;">
            Sube una foto de tu menu y extraeremos automaticamente los productos con sus precios.
          </p>
          <input type="file" id="menu-image-input" accept="image/*" style="display: none;" onchange="handleMenuImageUpload(event)">
          <button onclick="document.getElementById('menu-image-input').click()" style="background: white; color: #667eea; border: none; padding: 10px 20px; border-radius: 8px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px;">
            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/>
            </svg>
            Subir imagen
          </button>
          <div id="menu-upload-status" style="margin-top: 12px; font-size: 14px;"></div>
        </div>

        <div style="text-align: center; color: #718096; margin-bottom: 20px; font-size: 14px;">
          - o agrega productos manualmente -
        </div>

        <div class="form-group">
          <label class="form-label">Nombre del producto</label>
          <input type="text" class="form-input" id="item-name" placeholder="Ej: Hamburguesa ClÃ¡sica">
        </div>

        <div class="form-group">
          <label class="form-label">Precio (COP)</label>
          <input type="number" class="form-input" id="item-price" placeholder="25000">
        </div>

        <div class="form-group">
          <label class="form-label">DescripciÃ³n (opcional)</label>
          <input type="text" class="form-input" id="item-description" placeholder="Carne, lechuga, tomate...">
        </div>

        <div class="form-group">
          <label class="form-label">CategorÃ­a</label>
          <select class="form-select" id="item-category">
            <option value="Entradas">Entradas</option>
            <option value="Platos Principales">Platos Principales</option>
            <option value="Bebidas">Bebidas</option>
            <option value="Postres">Postres</option>
          </select>
        </div>

        <button class="btn-add" onclick="addMenuItem()">+ Agregar producto</button>

        <div class="menu-items" id="menu-items-list">
          <!-- Items will be added here -->
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeMenuModal()">Cancelar</button>
        <button class="btn-primary" onclick="saveMenu()">Guardar MenÃº</button>
      </div>
    </div>
  </div>

  <!-- Modal: Messages Config -->
  <div class="modal-overlay" id="messages-modal">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">
          <svg class="icon-lg" style="display: inline-block; vertical-align: middle; margin-right: 8px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
          </svg>
          Personalizar Mensajes
        </h2>
        <button class="modal-close" onclick="closeMessagesModal()">Ã—</button>
      </div>
      <div class="modal-body">
        <p style="margin-bottom: 24px; color: #718096;">
          Personaliza los mensajes automÃ¡ticos que envÃ­a el bot a tus clientes.
        </p>

        <div class="form-group">
          <label class="form-label">Mensaje de Bienvenida</label>
          <textarea class="form-textarea" id="msg-welcome" placeholder="Â¡Hola! ğŸ‘‹ Bienvenido a [Nombre Restaurante]..."></textarea>
          <div class="form-help">Se envÃ­a cuando un cliente escribe por primera vez</div>
        </div>

        <div class="form-group">
          <label class="form-label">Mensaje de ConfirmaciÃ³n de Pedido</label>
          <textarea class="form-textarea" id="msg-confirmation" placeholder="âœ… Â¡Pedido confirmado! Tu orden estÃ¡ siendo preparada..."></textarea>
          <div class="form-help">Se envÃ­a despuÃ©s de que el cliente confirma su pedido</div>
        </div>

        <div class="form-group">
          <label class="form-label">Mensaje de Despedida</label>
          <textarea class="form-textarea" id="msg-goodbye" placeholder="Â¡Gracias por tu pedido! ğŸ™ Esperamos verte pronto..."></textarea>
          <div class="form-help">Se envÃ­a al finalizar la conversaciÃ³n</div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeMessagesModal()">Cancelar</button>
        <button class="btn-primary" onclick="saveMessages()">Guardar Mensajes</button>
      </div>
    </div>
  </div>

  <!-- Modal: Test Bot -->
  <div class="modal-overlay" id="test-modal">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">ğŸ§ª Probar el Bot</h2>
        <button class="modal-close" onclick="closeTestModal()">Ã—</button>
      </div>
      <div class="modal-body">
        <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 16px; color: #2d3748;">
          ğŸ“± Tu nÃºmero de WhatsApp Business
        </h3>
        <div style="background: #f7fafc; padding: 16px; border-radius: 8px; margin-bottom: 24px;">
          <div style="font-size: 24px; font-weight: 700; color: #667eea;" id="test-phone-number">
            Cargando...
          </div>
        </div>

        <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 16px; color: #2d3748;">
          âœ… CÃ³mo probar el bot
        </h3>
        <ol style="padding-left: 20px; color: #4a5568; line-height: 1.8;">
          <li><strong>Abre WhatsApp</strong> en tu telÃ©fono</li>
          <li><strong>EnvÃ­a un mensaje</strong> al nÃºmero de arriba</li>
          <li><strong>Escribe:</strong> "Hola" o "MenÃº"</li>
          <li><strong>El bot responderÃ¡</strong> con el menÃº automÃ¡ticamente</li>
          <li><strong>Haz un pedido de prueba</strong> siguiendo las instrucciones</li>
          <li><strong>Revisa que aparezca</strong> en el KDS (pantalla de cocina)</li>
        </ol>

        <div style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 16px; border-radius: 4px; margin-top: 24px;">
          <strong style="color: #856404; display: block; margin-bottom: 8px;">âš ï¸ Nota importante:</strong>
          <p style="color: #856404; font-size: 14px; line-height: 1.6; margin: 0;">
            Si tu app aÃºn no estÃ¡ aprobada por Meta, es posible que el bot no responda aÃºn. 
            Una vez Meta apruebe tu aplicaciÃ³n, el bot empezarÃ¡ a funcionar automÃ¡ticamente.
          </p>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeTestModal()">Cerrar</button>
        <button class="btn-primary" onclick="markTestCompleted()">Ya probÃ© el bot âœ“</button>
      </div>
    </div>
  </div>

  <!-- Modal: Payment Config -->
  <div class="modal-overlay" id="payment-modal">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">ğŸ’³ Configurar Pagos Online</h2>
        <button class="modal-close" onclick="closePaymentModal()">Ã—</button>
      </div>
      <div class="modal-body">
        <p style="margin-bottom: 24px; color: #718096;">
          Acepta pagos con tarjeta de crÃ©dito/dÃ©bito a travÃ©s de Wompi. Tus clientes pagarÃ¡n online antes de confirmar el pedido.
        </p>

        <!-- Toggle de activaciÃ³n -->
        <div class="form-group">
          <div style="display: flex; justify-content: space-between; align-items: center; padding: 16px; background: #f7fafc; border-radius: 8px; margin-bottom: 24px;">
            <div>
              <label class="form-label" style="margin-bottom: 4px;">Habilitar Pagos Online</label>
              <div class="form-help">Los clientes deberÃ¡n pagar antes de confirmar su pedido</div>
            </div>
            <div class="bot-toggle" id="payment-toggle" onclick="togglePaymentEnabled()">
              <div class="bot-toggle-slider"></div>
            </div>
          </div>
        </div>

        <!-- Campos de credenciales (visibles solo si estÃ¡ habilitado) -->
        <div id="payment-credentials-section" style="display: none;">
          <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px; color: #2d3748;">
            ğŸ”‘ Credenciales de Wompi
          </h3>
          
          <div class="form-group">
            <label class="form-label">Public Key (Llave PÃºblica)</label>
            <input type="text" class="form-input" id="payment-public-key" placeholder="pub_test_..." autocomplete="off">
            <div class="form-help">Comienza con pub_test_ (pruebas) o pub_prod_ (producciÃ³n)</div>
          </div>

          <div class="form-group">
            <label class="form-label">Private Key (Llave Privada)</label>
            <input type="password" class="form-input" id="payment-private-key" placeholder="prv_test_..." autocomplete="off">
            <div class="form-help">Comienza con prv_test_ o prv_prod_. Nunca la compartas</div>
          </div>

          <div class="form-group">
            <label class="form-label">Integrity Secret (Secreto de Integridad)</label>
            <input type="password" class="form-input" id="payment-integrity-secret" placeholder="test_integrity_..." autocomplete="off">
            <div class="form-help">Usado para firmar transacciones</div>
          </div>

          <div class="form-group">
            <label class="form-label">Events Secret (Secreto de Eventos)</label>
            <input type="password" class="form-input" id="payment-events-secret" placeholder="test_events_..." autocomplete="off">
            <div class="form-help">Usado para validar webhooks</div>
          </div>

          <!-- BotÃ³n para probar credenciales -->
          <button class="btn-secondary" onclick="testPaymentCredentials()" style="width: 100%; margin-bottom: 24px;" id="btn-test-credentials">
            ğŸ§ª Probar Credenciales
          </button>

          <!-- Resultado de la prueba -->
          <div id="credentials-test-result" style="display: none; padding: 12px; border-radius: 8px; margin-bottom: 24px;">
            <div style="display: flex; align-items: center; gap: 8px;">
              <span id="test-result-icon"></span>
              <span id="test-result-message" style="font-weight: 600;"></span>
            </div>
          </div>

          <!-- Webhook URL -->
          <div style="background: #ebf8ff; border-left: 4px solid #4299e1; padding: 16px; border-radius: 4px; margin-bottom: 24px;">
            <h4 style="color: #2c5282; margin-bottom: 12px; font-weight: 600;">ğŸ“¡ URL del Webhook</h4>
            <p style="color: #2c5282; font-size: 13px; margin-bottom: 12px; line-height: 1.6;">
              Copia esta URL y configÃºrala en tu cuenta de Wompi (Panel â†’ Eventos â†’ Agregar Evento). 
              Esta URL permitirÃ¡ que Wompi notifique automÃ¡ticamente cuando se apruebe un pago.
            </p>
            <div style="display: flex; gap: 8px; align-items: center;">
              <input 
                type="text" 
                readonly 
                class="form-input" 
                id="webhook-url" 
                value="https://api.kdsapp.site/api/payments/webhook/wompi/TENANT_ID" 
                style="font-family: monospace; font-size: 12px; background: white;"
              >
              <button 
                class="btn-secondary" 
                onclick="copyWebhookUrl()" 
                style="flex-shrink: 0;"
              >
                ğŸ“‹ Copiar
              </button>
            </div>
          </div>

          <!-- GuÃ­a rÃ¡pida -->
          <div style="background: #fffaf0; border-left: 4px solid #f6ad55; padding: 16px; border-radius: 4px;">
            <h4 style="color: #7c2d12; margin-bottom: 8px; font-weight: 600;">ğŸ“š Â¿DÃ³nde encuentro mis credenciales?</h4>
            <ol style="padding-left: 20px; color: #7c2d12; font-size: 13px; line-height: 1.8; margin: 0;">
              <li>Ingresa a tu cuenta de Wompi (<a href="https://comercios.wompi.co/login" target="_blank" style="color: #c05621; text-decoration: underline;">comercios.wompi.co</a>)</li>
              <li>Ve a <strong>Desarrollo â†’ Programadores â†’ Llaves del API</strong></li>
              <li>Copia las llaves y pÃ©galas arriba</li>
              <li>Para webhooks: <strong>Desarrollo â†’ Programadores â†’ Pega la URL de arriba en URL de Eventos</strong></li>
            </ol>
          </div>
        </div>

        <!-- Mensaje cuando estÃ¡ deshabilitado -->
        <div id="payment-disabled-message" style="background: #f7fafc; padding: 24px; border-radius: 8px; text-align: center; color: #718096;">
          <div style="font-size: 48px; margin-bottom: 16px;">ğŸ”’</div>
          <p style="font-weight: 600; color: #4a5568; margin-bottom: 8px;">Pagos Online Deshabilitados</p>
          <p style="font-size: 14px;">Activa el interruptor arriba para configurar pagos con tarjeta.</p>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="closePaymentModal()">Cancelar</button>
        <button class="btn-primary" onclick="savePaymentConfig()" id="btn-save-payment">Guardar ConfiguraciÃ³n</button>
      </div>
    </div>
  </div>

  <!-- Modal: Delivery Time Config -->
  <div class="modal-overlay" id="delivery-time-modal">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">ğŸ•’ Configurar Tiempo de Entrega</h2>
        <button class="modal-close" onclick="closeDeliveryTimeModal()">Ã—</button>
      </div>
      <div class="modal-body">
        <p style="margin-bottom: 24px; color: #718096;">
          Configura el tiempo estimado de entrega que se mostrarÃ¡ a tus clientes al confirmar su pedido.
        </p>

        <div class="form-group">
          <label class="form-label">Tiempo Estimado de Entrega</label>
          <div style="display: flex; gap: 12px; align-items: center;">
            <input type="number" class="form-input" id="delivery-time-min" placeholder="30" min="10" max="120" style="flex: 1;">
            <span style="color: #4a5568; font-weight: 500;">-</span>
            <input type="number" class="form-input" id="delivery-time-max" placeholder="40" min="10" max="120" style="flex: 1;">
            <span style="color: #4a5568; font-weight: 500;">minutos</span>
          </div>
          <div class="form-help">Por ejemplo: 30-40 minutos, 20-30 minutos, etc.</div>
        </div>

        <div style="background: #f7fafc; padding: 16px; border-radius: 8px; margin-top: 16px;">
          <p style="font-size: 14px; color: #4a5568; margin-bottom: 8px;">
            <strong>Vista previa del mensaje:</strong>
          </p>
          <p style="color: #667eea; font-weight: 500;" id="delivery-time-preview">
            ğŸ•’ Tiempo estimado: 30-40 minutos
          </p>
        </div>

        <div style="background: #e6fffa; border-left: 4px solid #38b2ac; padding: 16px; border-radius: 4px; margin-top: 16px;">
          <strong style="color: #234e52; display: block; margin-bottom: 8px;">ğŸ’¡ RecomendaciÃ³n</strong>
          <p style="color: #234e52; font-size: 14px; line-height: 1.6; margin: 0;">
            Es mejor sobreestimar el tiempo de entrega. Si entregas antes, el cliente se sorprenderÃ¡ gratamente. 
            Si te atrasas, puede generar insatisfacciÃ³n.
          </p>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeDeliveryTimeModal()">Cancelar</button>
        <button class="btn-primary" onclick="saveDeliveryTime()">Guardar Tiempo</button>
      </div>
    </div>
  </div>

  <!-- Modal: Delivery Cost Config -->
  <div class="modal-overlay" id="delivery-cost-modal">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">ğŸšš Configurar Costo de EnvÃ­o</h2>
        <button class="modal-close" onclick="closeDeliveryCostModal()">Ã—</button>
      </div>
      <div class="modal-body">
        <p style="margin-bottom: 24px; color: #718096;">
          Configura el costo de envÃ­o/domicilio que se aplicarÃ¡ a los pedidos de tus clientes.
        </p>

        <div class="form-group">
          <label class="form-label">Costo de EnvÃ­o</label>
          <div style="display: flex; gap: 12px; align-items: center;">
            <span style="color: #4a5568; font-weight: 500; font-size: 18px;">$</span>
            <input type="number" class="form-input" id="delivery-cost-value" placeholder="5000" min="0" step="500" style="flex: 1;">
          </div>
          <div class="form-help">Ingresa 0 si ofreces envÃ­o gratis</div>
        </div>

        <div class="form-group" style="margin-top: 16px;">
          <label class="form-label">MÃ­nimo para envÃ­o gratis (opcional)</label>
          <div style="display: flex; gap: 12px; align-items: center;">
            <span style="color: #4a5568; font-weight: 500; font-size: 18px;">$</span>
            <input type="number" class="form-input" id="free-delivery-min" placeholder="50000" min="0" step="1000" style="flex: 1;">
          </div>
          <div class="form-help">Deja vacÃ­o si no aplicas envÃ­o gratis por monto mÃ­nimo</div>
        </div>

        <div style="background: #f7fafc; padding: 16px; border-radius: 8px; margin-top: 16px;">
          <p style="font-size: 14px; color: #4a5568; margin-bottom: 8px;">
            <strong>Vista previa del mensaje:</strong>
          </p>
          <p style="color: #667eea; font-weight: 500;" id="delivery-cost-preview">
            ğŸšš Costo de envÃ­o: $5,000
          </p>
        </div>

        <div style="background: #e6fffa; border-left: 4px solid #38b2ac; padding: 16px; border-radius: 4px; margin-top: 16px;">
          <strong style="color: #234e52; display: block; margin-bottom: 8px;">ğŸ’¡ Sugerencia</strong>
          <p style="color: #234e52; font-size: 14px; line-height: 1.6; margin: 0;">
            Ofrecer envÃ­o gratis a partir de cierto monto puede incentivar a tus clientes a pedir mÃ¡s productos.
          </p>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeDeliveryCostModal()">Cancelar</button>
        <button class="btn-primary" onclick="saveDeliveryCost()">Guardar Costo</button>
      </div>
    </div>
  </div>

  <!-- Modal: Business Hours Config -->
  <div class="modal-overlay" id="business-hours-modal">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">ğŸ“… Horarios de AtenciÃ³n</h2>
        <button class="modal-close" onclick="closeBusinessHoursModal()">Ã—</button>
      </div>
      <div class="modal-body">
        <p style="margin-bottom: 16px; color: #718096;">
          Configura los dÃ­as y horarios en que tu bot estarÃ¡ disponible para recibir pedidos. Fuera de estos horarios, el bot no responderÃ¡.
        </p>

        <!-- Timezone Selector -->
        <div class="form-group" style="margin-bottom: 24px;">
          <label class="form-label">ğŸŒ Zona Horaria de tu negocio</label>
          <select class="form-select" id="business-timezone" onchange="updateTimezonePreview()">
            <option value="America/Bogota">ğŸ‡¨ğŸ‡´ Colombia (GMT-5)</option>
            <option value="America/Mexico_City">ğŸ‡²ğŸ‡½ MÃ©xico Centro (GMT-6)</option>
            <option value="America/Cancun">ğŸ‡²ğŸ‡½ MÃ©xico Quintana Roo (GMT-5)</option>
            <option value="America/Tijuana">ğŸ‡²ğŸ‡½ MÃ©xico PacÃ­fico (GMT-8)</option>
            <option value="America/Lima">ğŸ‡µğŸ‡ª PerÃº (GMT-5)</option>
            <option value="America/Santiago">ğŸ‡¨ğŸ‡± Chile (GMT-3/-4)</option>
            <option value="America/Argentina/Buenos_Aires">ğŸ‡¦ğŸ‡· Argentina (GMT-3)</option>
            <option value="America/Caracas">ğŸ‡»ğŸ‡ª Venezuela (GMT-4)</option>
            <option value="America/Guayaquil">ğŸ‡ªğŸ‡¨ Ecuador (GMT-5)</option>
            <option value="America/La_Paz">ğŸ‡§ğŸ‡´ Bolivia (GMT-4)</option>
            <option value="America/Panama">ğŸ‡µğŸ‡¦ PanamÃ¡ (GMT-5)</option>
            <option value="America/Santo_Domingo">ğŸ‡©ğŸ‡´ Rep. Dominicana (GMT-4)</option>
            <option value="America/Costa_Rica">ğŸ‡¨ğŸ‡· Costa Rica (GMT-6)</option>
            <option value="America/Guatemala">ğŸ‡¬ğŸ‡¹ Guatemala (GMT-6)</option>
            <option value="America/Tegucigalpa">ğŸ‡­ğŸ‡³ Honduras (GMT-6)</option>
            <option value="America/El_Salvador">ğŸ‡¸ğŸ‡» El Salvador (GMT-6)</option>
            <option value="America/Managua">ğŸ‡³ğŸ‡® Nicaragua (GMT-6)</option>
            <option value="America/Asuncion">ğŸ‡µğŸ‡¾ Paraguay (GMT-3/-4)</option>
            <option value="America/Montevideo">ğŸ‡ºğŸ‡¾ Uruguay (GMT-3)</option>
            <option value="America/Havana">ğŸ‡¨ğŸ‡º Cuba (GMT-5)</option>
            <option value="America/New_York">ğŸ‡ºğŸ‡¸ EE.UU. Este (GMT-5)</option>
            <option value="America/Chicago">ğŸ‡ºğŸ‡¸ EE.UU. Centro (GMT-6)</option>
            <option value="America/Denver">ğŸ‡ºğŸ‡¸ EE.UU. MontaÃ±a (GMT-7)</option>
            <option value="America/Los_Angeles">ğŸ‡ºğŸ‡¸ EE.UU. PacÃ­fico (GMT-8)</option>
            <option value="Europe/Madrid">ğŸ‡ªğŸ‡¸ EspaÃ±a (GMT+1/+2)</option>
          </select>
          <div class="form-help" id="timezone-preview">Hora actual en tu zona: --:--</div>
        </div>

        <!-- Days Schedule -->
        <div id="business-hours-days" style="display: flex; flex-direction: column; gap: 12px;">
          <!-- Lunes -->
          <div class="schedule-day-row" data-day="monday">
            <div class="schedule-day-toggle">
              <label class="schedule-checkbox">
                <input type="checkbox" id="day-monday-active" onchange="toggleDaySchedule('monday')">
                <span class="schedule-checkbox-visual"></span>
              </label>
              <span class="schedule-day-name">Lunes</span>
            </div>
            <div class="schedule-day-times" id="day-monday-times">
              <input type="time" class="form-input schedule-time-input" id="day-monday-open" value="08:00">
              <span style="color: #4a5568; font-weight: 500;">a</span>
              <input type="time" class="form-input schedule-time-input" id="day-monday-close" value="20:00">
            </div>
          </div>
          <!-- Martes -->
          <div class="schedule-day-row" data-day="tuesday">
            <div class="schedule-day-toggle">
              <label class="schedule-checkbox">
                <input type="checkbox" id="day-tuesday-active" onchange="toggleDaySchedule('tuesday')">
                <span class="schedule-checkbox-visual"></span>
              </label>
              <span class="schedule-day-name">Martes</span>
            </div>
            <div class="schedule-day-times" id="day-tuesday-times">
              <input type="time" class="form-input schedule-time-input" id="day-tuesday-open" value="08:00">
              <span style="color: #4a5568; font-weight: 500;">a</span>
              <input type="time" class="form-input schedule-time-input" id="day-tuesday-close" value="20:00">
            </div>
          </div>
          <!-- MiÃ©rcoles -->
          <div class="schedule-day-row" data-day="wednesday">
            <div class="schedule-day-toggle">
              <label class="schedule-checkbox">
                <input type="checkbox" id="day-wednesday-active" onchange="toggleDaySchedule('wednesday')">
                <span class="schedule-checkbox-visual"></span>
              </label>
              <span class="schedule-day-name">MiÃ©rcoles</span>
            </div>
            <div class="schedule-day-times" id="day-wednesday-times">
              <input type="time" class="form-input schedule-time-input" id="day-wednesday-open" value="08:00">
              <span style="color: #4a5568; font-weight: 500;">a</span>
              <input type="time" class="form-input schedule-time-input" id="day-wednesday-close" value="20:00">
            </div>
          </div>
          <!-- Jueves -->
          <div class="schedule-day-row" data-day="thursday">
            <div class="schedule-day-toggle">
              <label class="schedule-checkbox">
                <input type="checkbox" id="day-thursday-active" onchange="toggleDaySchedule('thursday')">
                <span class="schedule-checkbox-visual"></span>
              </label>
              <span class="schedule-day-name">Jueves</span>
            </div>
            <div class="schedule-day-times" id="day-thursday-times">
              <input type="time" class="form-input schedule-time-input" id="day-thursday-open" value="08:00">
              <span style="color: #4a5568; font-weight: 500;">a</span>
              <input type="time" class="form-input schedule-time-input" id="day-thursday-close" value="20:00">
            </div>
          </div>
          <!-- Viernes -->
          <div class="schedule-day-row" data-day="friday">
            <div class="schedule-day-toggle">
              <label class="schedule-checkbox">
                <input type="checkbox" id="day-friday-active" onchange="toggleDaySchedule('friday')">
                <span class="schedule-checkbox-visual"></span>
              </label>
              <span class="schedule-day-name">Viernes</span>
            </div>
            <div class="schedule-day-times" id="day-friday-times">
              <input type="time" class="form-input schedule-time-input" id="day-friday-open" value="08:00">
              <span style="color: #4a5568; font-weight: 500;">a</span>
              <input type="time" class="form-input schedule-time-input" id="day-friday-close" value="20:00">
            </div>
          </div>
          <!-- SÃ¡bado -->
          <div class="schedule-day-row" data-day="saturday">
            <div class="schedule-day-toggle">
              <label class="schedule-checkbox">
                <input type="checkbox" id="day-saturday-active" onchange="toggleDaySchedule('saturday')">
                <span class="schedule-checkbox-visual"></span>
              </label>
              <span class="schedule-day-name">SÃ¡bado</span>
            </div>
            <div class="schedule-day-times" id="day-saturday-times">
              <input type="time" class="form-input schedule-time-input" id="day-saturday-open" value="09:00">
              <span style="color: #4a5568; font-weight: 500;">a</span>
              <input type="time" class="form-input schedule-time-input" id="day-saturday-close" value="21:00">
            </div>
          </div>
          <!-- Domingo -->
          <div class="schedule-day-row" data-day="sunday">
            <div class="schedule-day-toggle">
              <label class="schedule-checkbox">
                <input type="checkbox" id="day-sunday-active" onchange="toggleDaySchedule('sunday')">
                <span class="schedule-checkbox-visual"></span>
              </label>
              <span class="schedule-day-name">Domingo</span>
            </div>
            <div class="schedule-day-times" id="day-sunday-times">
              <input type="time" class="form-input schedule-time-input" id="day-sunday-open" value="09:00">
              <span style="color: #4a5568; font-weight: 500;">a</span>
              <input type="time" class="form-input schedule-time-input" id="day-sunday-close" value="21:00">
            </div>
          </div>
        </div>

        <!-- Copiar horario -->
        <div style="margin-top: 16px; display: flex; gap: 8px;">
          <button class="btn-secondary" onclick="applyScheduleToAll()" style="flex: 1; font-size: 13px;">
            ğŸ“‹ Copiar Lunes a todos los dÃ­as activos
          </button>
        </div>

        <!-- Preview -->
        <div style="background: #f7fafc; padding: 16px; border-radius: 8px; margin-top: 16px;">
          <p style="font-size: 14px; color: #4a5568; margin-bottom: 8px;">
            <strong>Vista previa del estado actual:</strong>
          </p>
          <p style="color: #667eea; font-weight: 500;" id="business-hours-preview">
            Configura tus horarios arriba
          </p>
        </div>

        <div style="background: #e6fffa; border-left: 4px solid #38b2ac; padding: 16px; border-radius: 4px; margin-top: 16px;">
          <strong style="color: #234e52; display: block; margin-bottom: 8px;">ğŸ’¡ Importante</strong>
          <p style="color: #234e52; font-size: 14px; line-height: 1.6; margin: 0;">
            El bot solo responderÃ¡ mensajes dentro de los horarios configurados. Fuera de horario, no enviarÃ¡ ninguna respuesta. 
            AsegÃºrate de seleccionar correctamente la zona horaria de tu negocio.
          </p>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeBusinessHoursModal()">Cancelar</button>
        <button class="btn-primary" onclick="saveBusinessHours()">Guardar Horarios</button>
      </div>
    </div>
  </div>

  <!-- Modal: My Plan -->
  <div class="modal-overlay" id="my-plan-modal">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">
          <svg class="icon-lg" style="display: inline-block; vertical-align: middle; margin-right: 8px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"/>
          </svg>
          Mi Plan
        </h2>
        <button class="modal-close" onclick="closeMyPlanModal()">Ã—</button>
      </div>
      <div class="modal-body">
        <div id="plan-loading" style="text-align: center; padding: 40px 20px;">
          <div class="spinner" style="margin: 0 auto 16px;"></div>
          <p style="color: #718096;">Cargando informaciÃ³n de tu plan...</p>
        </div>
        
        <div id="plan-content" style="display: none;">
          <!-- Plan Badge -->
          <div style="text-align: center; margin-bottom: 24px;">
            <div id="plan-badge" style="display: inline-block; padding: 12px 24px; border-radius: 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; font-weight: 600; font-size: 18px; text-transform: uppercase; letter-spacing: 1px;">
              Plan BÃ¡sico
            </div>
          </div>

          <!-- Plan Details -->
          <div style="background: #f7fafc; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
            <div style="display: grid; gap: 16px;">
              <!-- Estado -->
              <div>
                <div style="color: #718096; font-size: 14px; margin-bottom: 4px;">Estado</div>
                <div id="plan-status" style="color: #2d3748; font-weight: 500; font-size: 16px;">
                  <span style="display: inline-block; width: 8px; height: 8px; border-radius: 50%; background: #48bb78; margin-right: 8px;"></span>
                  Activo
                </div>
              </div>

              <!-- Fecha de inicio -->
              <div>
                <div style="color: #718096; font-size: 14px; margin-bottom: 4px;">Inicio del plan</div>
                <div id="plan-start-date" style="color: #2d3748; font-weight: 500; font-size: 16px;">-</div>
              </div>

              <!-- Fecha de vencimiento -->
              <div>
                <div style="color: #718096; font-size: 14px; margin-bottom: 4px;">Vence el</div>
                <div id="plan-expiry-date" style="color: #2d3748; font-weight: 500; font-size: 16px;">-</div>
              </div>

              <!-- DÃ­as restantes -->
              <div>
                <div style="color: #718096; font-size: 14px; margin-bottom: 4px;">DÃ­as restantes</div>
                <div id="plan-days-remaining" style="color: #667eea; font-weight: 600; font-size: 20px;">-</div>
              </div>
            </div>
          </div>

          <!-- CaracterÃ­sticas del plan -->
          <div style="background: #ffffff; border: 1px solid #e2e8f0; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 16px;">
              <svg style="width: 20px; height: 20px; color: #667eea;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/>
              </svg>
              <h3 style="color: #2d3748; font-size: 16px; margin: 0; font-weight: 600;">CaracterÃ­sticas incluidas</h3>
            </div>
            <div id="plan-features" style="display: grid; gap: 12px;">
              <!-- Features will be loaded here -->
            </div>
          </div>

          <!-- Upgrade suggestion (for trial/emprendedor) -->
          <div id="upgrade-suggestion" style="display: none; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; padding: 20px; color: white; text-align: center;">
            <div style="display: flex; align-items: center; justify-content: center; gap: 8px; margin-bottom: 8px;">
              <svg style="width: 24px; height: 24px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
              </svg>
              <h3 style="font-size: 18px; margin: 0;">Mejora tu plan</h3>
            </div>
            <p style="margin-bottom: 16px; opacity: 0.9;">Desbloquea mÃ¡s funciones y haz crecer tu negocio</p>
            <button class="btn-primary" onclick="window.location.href='plans.html'" style="background: white; color: #667eea;">
              Ver planes disponibles
            </button>
          </div>
        </div>

        <div id="plan-error" style="display: none; text-align: center; padding: 40px 20px;">
          <svg style="width: 64px; height: 64px; margin: 0 auto 16px; color: #fc8181;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
          </svg>
          <p style="color: #e53e3e; font-weight: 500; margin-bottom: 8px;">Error al cargar la informaciÃ³n</p>
          <p style="color: #718096; font-size: 14px;">Por favor intenta nuevamente</p>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeMyPlanModal()">Cerrar</button>
        <button class="btn-primary" onclick="window.location.href='plans.html'">Cambiar Plan</button>
      </div>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
  
  <!-- Firebase Configuration (initializes Firebase) -->
  <script src="config.js"></script>
  
  <!-- Membership Check -->
  <script src="js/membership-check.js"></script>
  <script>
    // Verificar membresÃ­a antes de cargar Dashboard
    MembershipCheck.init({ blockOnExpired: true });
  </script>
  
  <!-- Dashboard Script -->
  <script src="js/dashboard.js?v=20260205v2"></script>
</body>
</html>
